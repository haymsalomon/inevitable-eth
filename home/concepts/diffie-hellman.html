<!--
title: Diffie-Hellman Key Exchange
description: 
published: true
date: 2022-11-30T16:22:40.734Z
tags: 
editor: undefined
dateCreated: 2022-11-30T16:22:36.751Z
-->

<figure class="image"><img src="/diffie-hellman-1.jpeg"></figure>
<h1 style="text-align:center;">Diffie-Hellman Key Exchange</h1>
<h2>Prerequisites</h2>
<h3>Modular Arithmetic</h3>
<p>When you divide two integers, sometimes the result is not an integer (eg has a reminder). <a href="https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/what-is-modular-arithmetic">Modular arithmetic</a> is a branch of math that is focused on the reminder.</p>
<p>The modulo operator (written as "mod") is the operation that finds the remainder.&nbsp;</p>
<ul>
  <li>10 / 3 = 3 with a remainder of 1 = 10 mod 3 = 1&nbsp;</li>
  <li>14 / 6 = 2 with a remainder of 2 = 14 mod 6 = 2&nbsp;</li>
  <li>3 / 10 = 0 with a remainder of 3 = 3 mod 10 = 3&nbsp;</li>
</ul>
<p>Imagine a clock being mod 12.</p>
<h2>Communicating in Public&nbsp;</h2>
<p>Let's say you need to communicate sensitive data across a public channel. If you know other people can read your data, you might decide to cryptographically encode it.&nbsp;</p>
<p>Encoding is the process of transforming the original data into an undecipherable (but reversible) form.</p>
<p>Encoding is only useful in one condition: if (ONLY) the intended recipient can decode the message, transforming it back into its original form.&nbsp;</p>
<p>If we can pull this off, we can securely share sensitive data even while broadcasting it to the entire world.</p>
<p>In order to do this, we use a cryptographic algorithm.&nbsp;</p>
<p>A cryptographic algorithm receives a message and an encryption key. If the message is not encrypted, the algorithm will encode it. If the message is encrypted, the algorithm will decode it.</p>
<p>We will just take the cryptographic algorithm for granted; you can just treat it like a black box. We are interested in the encryption key.&nbsp;</p>
<p>More specifically, we are interested in understanding how to create a key.</p>
<h2>Generating a Key</h2>
<p>Due to the nature of a cryptographic algorithm, anyone with the encryption key is able to decode the message. If you don't have a private channel to create/agree upon the key, how can do it in the open?&nbsp;</p>
<p>How do you establish a shared secret in public?</p>
<p>Our answer comes from over 40 years ago by Whitfield Diffie and Martin Hellman: <a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">Diffie-Hellman Key Exchange</a>.&nbsp;</p>
<p>This scheme was the first method of creating a shared secret that didn't require the literal physical exchange of encryption keys (via paper, disk, etc).</p>
<h2>Mixing Paint</h2>
<figure class="image"><img src="/diffie-hellman-2.jpeg"></figure>
<p>Diffie-Hellman has a classic metaphor that is very helpful: mixing paint. In the metaphor, the goal is to create a secret color that only the participants know.</p>
<h3>Phase 1</h3>
<figure class="image"><img src="/diffie-hellman-3.jpeg"></figure>
<p>Diffie-Hellman begins with two parties (Satoshi, Vitalik), a public data channel and two publicly available numbers: g and n (yellow).&nbsp;</p>
<p>g and n are either agreed upon before hand, using some industry standard, or are agreed upon in public before the process starts.</p>
<p>Both parties have a secret number (Satoshi - a, red) (Vitalik - b, blue).&nbsp;</p>
<p>These numbers are the keys to every message sent by their owner; their privacy is paramount.</p>
<p>To begin the process, both parties import the publicly available data (g and n - yellow) and apply their secret number.&nbsp;</p>
<p>The formula below is a little scary; let me break it down. All we are doing is multiplying g by itself a/b times and then applying mod n.</p>
<h4>Example</h4>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td>
          <figure class="image"><img src="/diffie-hellman-4.png"></figure>
        </td>
        <td>
          <figure class="image"><img src="/diffie-hellman-5.png"></figure>
        </td>
      </tr>
    </tbody>
  </table>
</figure>
<h3>Phase 2</h3>
<figure class="image"><img src="/diffie-hellman-6.jpeg"></figure>
<p>Next, both parties will send this new value back across the public channel.&nbsp;</p>
<p>At this point both values become public, however no observer can recover the original data. The critical piece is the modulo function.</p>
<h4>Example</h4>
<p><i>(these need to be fixed)</i></p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td>
          <figure class="image"><img src="/diffie-hellman-7.png"></figure>
        </td>
        <td>
          <figure class="image"><img src="/diffie-hellman-8.png"></figure>
        </td>
      </tr>
    </tbody>
  </table>
</figure>
<h3>Phase 3</h3>
<p>Once both parties have this intermediate value, they can repeat the process they used to make it: multiply the new value a/b times and take the remainder when you divide by n.&nbsp;</p>
<p>Here's where the magic happens: Now you both have the same number; a number no one else knows.</p>
<h2>One Way Functions</h2>
<h3>Clock</h3>
<p>Let's think about a clock as a system with mod 12.&nbsp;</p>
<p>Just because you know we start at 4 (g) and where we end at 6 (g^a mod n) doesn't give you enough information to know how long we lasted: 2 hours? 14 hours? 26 hours?&nbsp;</p>
<p>g^a mod n is the same problem!</p>
<h3>Discrete Logarithm Problem</h3>
<p>It turns out there isn't a great way to do this other to just start guessing.&nbsp;</p>
<p>Our examples are using tiny numbers, but in practice these values would be hundreds of digits long.&nbsp;</p>
<p>Guessing is not just difficult, its <a href="https://en.wikipedia.org/wiki/Discrete_logarithm">nearly impossible</a> (although that's <a href="https://en.wikipedia.org/wiki/Shor%27s_algorithm">becoming less true</a>).</p>
<h2>A Public Secret</h2>
<p>And so, after you complete the Diffie-Hellman key exchange process, both parties have a shared secret. They both can be confident that they (and only they) will the only ones able to read messages that use that value as an encryption key.&nbsp;</p>
<p>A public secret!</p>
<h2>Resources</h2>
<p>Further Reading/Watching</p>
<ul>
  <li><a href="https://www.youtube.com/watch?v=Yjrfm_oRO0w">Diffie-Hellman Key Exchange</a></li>
  <li><a href="https://www.youtube.com/watch?v=NmM9HA2MQGI">Classic Paint Metaphor</a></li>
</ul>
<p>Source Material - <a href="https://twitter.com/SalomonCrypto/status/1580388773937881093">Twitter Link</a></p>
<p>Source Material - <a href="/twitter-pdf-2022-10-13_diffie_hellman.pdf">PDF</a></p>
<p>&nbsp;</p>
